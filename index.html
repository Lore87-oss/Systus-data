Papa.parse("https://lore87-oss.github.io/Systus-data/FB_Nuovo_Albero.csv", {
    download: true,
    header: true,
    complete: function(results) {

        console.log("CSV CARICATO:", results.data); // DEBUG

        results.data.forEach(row => {

            // Controllo se ci sono coordinate
            if (!row.CenterLat || !row.CenterLng) {
                console.log("RIGA SENZA COORDINATE:", row);
                return;
            }

            let lat = parseFloat(row.CenterLat);
            let lng = parseFloat(row.CenterLng);

            if (isNaN(lat) || isNaN(lng)) {
                console.log("COORDINATE NON VALIDE:", row.CenterLat, row.CenterLng);
                return;
            }

            L.circleMarker([lat, lng], {
                radius: 6,
                color: "red",
                fillColor: "red",
                fillOpacity: 1
            })
            .bindPopup(`
                <b>Albero</b><br>
                Specie: ${row.Specie || "N/D"}<br>
                ID: ${row.ID || "N/D"}
            `)
            .addTo(map);
        });
    }
});
