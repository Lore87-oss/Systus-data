

fetch("https://lore87-oss.github.io/Systus-data/Aree_verdi_28_11_2025_105715.csv")
  .then(response => response.text())
  .then(text => {

   
    const header = text.split("\n")[0].split(",");
    const data = text.split("\n")[1]; 

  
    const idxNome = header.indexOf("Nome");
    const idxIndirizzo = header.indexOf("Indirizzo");
    const idxWKT = header.indexOf("WKT");

    
    let parts = data.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);

   
    parts = parts.map(v => v.replace(/^"|"$/g, ''));

   
    const wkt = parts[idxWKT];
    const nome = parts[idxNome];
    const indirizzo = parts[idxIndirizzo];

   
    const geom = wellknown(wkt);

  
    L.geoJSON(geom, {
      style: {
        color: "green",
        fillColor: "lightgreen",
        weight: 2,
        fillOpacity: 0.4
      }
    })
    .bindPopup(`<b>${nome}</b><br>${indirizzo}`)
    .addTo(map);

  });
