<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Webmap Systus – CSV live</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    #map { height: 95vh; width: 100%; }
    body { margin:0; font-family:Arial; }
  </style>
</head>

<body>

<h2 style="text-align:center; margin:10px 0;">Webmap Systus – CSV live</h2>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/wellknown/wellknown.js"></script>

<script>
// =========================================================
// CREA MAPPA
// =========================================================
const map = L.map("map").setView([41.9028, 12.4964], 12);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

// =========================================================
// CARICA ALBERI DAL CSV
// =========================================================
fetch("https://lore87-oss.github.io/Systus-data/FB_Nuovo_Albero_28_11_2025%20(2).csv")
  .then(r => r.text())
  .then(text => {
    const rows = text.split("\n");
    const headers = rows[0].split(",");

    const idxLat = headers.indexOf("Lat");
    const idxLng = headers.indexOf("Lng");
    const idxSpecie = headers.indexOf("Specie");

    for (let i = 1; i < rows.length; i++) {
      const cols = rows[i].split(",");
      const lat = parseFloat(cols[idxLat]);
      const lng = parseFloat(cols[idxLng]);
      const specie = cols[idxSpecie];

      if (!isNaN(lat) && !isNaN(lng)) {
        L.circleMarker([lat, lng], {
          radius: 6,
          color: "red"
        })
        .bindPopup(`<b>Albero</b><br>Specie: ${specie}`)
        .addTo(map);
      }
    }
  });

// =========================================================
// CARICA AREE VERDI (GeoJSON)
// =========================================================
fetch("https://lore87-oss.github.io/Systus-data/Aree_verdi.geojson")
  .then(r => r.json())
  .then(geojson => {
    L.geoJSON(geojson, {
      style: {
        color: "green",
        fillColor: "lightgreen",
        weight: 2,
        fillOpacity: 0.4
      },
      onEachFeature: (f, layer) => {
        const nome = f.properties?.Nome || "Area verde";
        const indirizzo = f.properties?.Indirizzo || "";
        layer.bindPopup(`<b>${nome}</b><br>${indirizzo}`);
      }
    }).addTo(map);
  });

</script>

</body>
</html>
