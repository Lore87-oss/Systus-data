<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Webmap Systus – CSV Live</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
        body { margin:0; padding:0; }
        #map { width:100%; height:100vh; }
    </style>
</head>
<body>

<h2 style="text-align:center;">Webmap Systus – CSV live</h2>
<div id="map"></div>

<script>

const map = L.map('map').setView([41.9028, 12.4964], 11);


L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);


const alberiCSV = "https://raw.githubusercontent.com/Lore87-oss/Systus-data/main/FB_Nuovo%20Albero_28_11_2025%20(2).csv";
const areeCSV = "https://raw.githubusercontent.com/Lore87-oss/Systus-data/main/Aree_verdi_28_11_2025_105715.csv";



function loadCSV(url, callback) {
    Papa.parse(url, {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: callback
    });
}



loadCSV(alberiCSV, function(result) {
    result.data.forEach(row => {
        if (!row.Latitudine || !row.Longitudine) return;

        L.circleMarker([row.Latitudine, row.Longitudine], {
            radius: 5,
            color: "red",
            fillColor: "red",
            fillOpacity: 0.7
        })
        .bindPopup(`
            <b>Albero</b><br>
            Specie: ${row.Specie || "N/D"}<br>
            ID: ${row.ID || "N/D"}
        `)
        .addTo(map);
    });
});



loadCSV(areeCSV, function(result) {
    result.data.forEach(row => {
        if (!row.lat || !row.lon) return;

        // caso aree come punti
        L.circleMarker([row.lat, row.lon], {
            radius: 7,
            color: "green",
            fillColor: "green",
            fillOpacity: 0.5
        })
        .bindPopup(`
            <b>Area verde</b><br>
            Nome: ${row.Nome || "N/D"}
        `)
        .addTo(map);
    });
});

</script>
</body>
</html>

